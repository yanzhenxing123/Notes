# 数据结构

## string (SDS)

功能

+ 缓存
+ 计数器（inc, decr）
+ 共享用户的session

## list

列表，双端队列，可以实现消息队列

## set

无序集合，自动去重，可以求两个用户之间的共同好友

## zset

有序集合，可以用于排行榜

## hash

类似于map，存储商品的属性等等

## bitmap

+ 布隆过滤器：判断一个字符串一定不存在或者可能存在
+ 统计用户的登陆情况
+ 判断用户是否在线
+ 用户签到

## hyperloglog

HyperLogLog 是一种**基数估算**算法。所谓基数估算，就是估算在一批数据中，不重复元素的个数有多少。

+ 访问量很大时，记录用户的访问量（估值）

## Geospatial

保存地理位置信息，并作位置距离计算或者根据半径计算位置等。

+ 附近的人实现
+ 计算最优地图路径

## sub/pub(发布订阅)

+ 简单的消息队列

## Pipeline

+ 批量执行一组指令，一次性返回全部结果, 减少频繁的请求访答

## lua脚本

支持提交 **Lua** 脚本来执行一系列的功能

# 单线程

**1. redis是单线程还是多线程？**

因为redis网络事件的开发基于reactor模式，文件事件分配器对事件队列的消费是单线程的，所以说redis是单线程的。

## 事务

不提供严格的事务，串行执行指令，并且保证全部执行，但是执行命令失败不会回滚，而是会继续执行下去。

## 持久化

rdb做全量持久化，aof做增量持久化

### RDB

机制：fork和cow，fork是指redis通过创建子进程来进行rdb操作，cow指的是copy on write, 父子进程共享数据段，父进程提供读写操作，父进程的此时写的脏页面会逐渐和子进程分离开来。

### AOF

每一次更新都会对指令进行追加操作，性能较低，可以将缓存区的数据一次性添加到数据库（异步），





# 面试题

1. redis为什么这么快？
   + 基于内存，数据结构类似于hashmap，优势是查找时间复杂度为O(1)
   + C语言编写的单进程单线程模式，避免了不必要的上下文交换，避免了加锁和释放锁的操作，没有因为可能出现死锁而导致的性能消耗。
   + IO多路复用模型，非阻塞io
   + 构建了自己的VM（虚拟内存）模式，一般的系统调用会浪费一定的时间去移动和请求, 把冷数据放到磁盘中，热数据放在内存中.

2. 如何保证高可用

   + sentinel（哨兵）模式

3. 哨兵模式如何选master

   + slave的priority设置的越低优先级越高
   + 数据复制的越多，优先级越高
   + 相同情况下，runid较小的越容易被选中

4. 为什么哨兵必须是三个以上，不能是两个？

   如果是两个：

   + 因为如果master宕机了，两个哨兵没有宕机，那么