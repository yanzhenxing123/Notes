## basis

分布式系统的重要组件之一

### 作用

+ 通过异步处理提高系统的性能（**减少响应所需时间**）
+ 削峰/限流
+ 降低系统的耦合性



### 通过异步处理提高系统的性能

![image 1](https://camo.githubusercontent.com/b027d1b1d1c8b30e71c13b60e2aee3ca8ef310e125e0653abf29d2ddf3533f37/68747470733a2f2f6d792d626c6f672d746f2d7573652e6f73732d636e2d6265696a696e672e616c6979756e63732e636f6d2f323031392d31312f4173796e6368726f6e6f75732d6d6573736167652d71756575652e706e67 )



存在问题：放入消息队列后并没有成功



### 削峰 / 限流

**先将短时间高并发产生的事务消息存储在消息队列中，然后后端服务再慢慢根据自己的能力去消费这些消息，这样就避免直接把后端服务打垮掉，相当于做一个缓冲**。

![image-20210913182902725](https://camo.githubusercontent.com/376a4ad36ea220df1b9af6499e1e119c4e07ed2f9b91db5486dd4ef9bcf98b24/68747470733a2f2f6d792d626c6f672d746f2d7573652e6f73732d636e2d6265696a696e672e616c6979756e63732e636f6d2f323031392d31312f2545352538392538412545352542332542302d2545362542362538382545362538312541462545392539382539462545352538382539372e706e67)

### 降低系统的耦合性

![68747470733a2f2f6d792d626c6f672d746f2d7573652e6f73732d636e2d6265696a696e672e616c6979756e63732e636f6d2f323031392d31312f2545362542362538382545362538312541462545392539382539462545352538382539372d2545382541372541332545382538302541362e706e67 (631×283)](https://camo.githubusercontent.com/3de1f8969528f490c440f3b6f93dc654c810854b0e018ea8ad505884cb7cc8b8/68747470733a2f2f6d792d626c6f672d746f2d7573652e6f73732d636e2d6265696a696e672e616c6979756e63732e636f6d2f323031392d31312f2545362542362538382545362538312541462545392539382539462545352538382539372d2545382541372541332545382538302541362e706e67)

模块与模块之间不存在直接调用，生产者（客户端）发送消息到消息队列中去，接受者（服务端）处理消息，需要消费的系统直接去消息队列取消息进行消费即可而不需要和其他系统有耦合，这显然也提高了系统的扩展性。发布-订阅模式。

除了发布订阅模式，还有就是点对点，即一个生产者对应一个消费者（P2P），但是比较常用的就是发布订阅模式。



#### 事件驱动架构（EDA）

典型的EDA架构就是消费者生产者模式。



## 带来的问题

+ 系统的可用性降低：消息队列中的数据消失
+ 系统的复杂性提高：要确保数据的丢失情况、数据的顺序、数据有没有被重复消费
+ 一致性问题：真正消费者并没有正确消费消息



 ## JMS和AMQP

JMS支持的消息正文格式

- StreamMessage -- Java 原始值的数据流
- MapMessage--一套名称-值对
- TextMessage--一个字符串对象
- ObjectMessage--一个序列化的 Java 对象
- BytesMessage--一个字节的数据流

| 对比方向     |                   JMS                   |                             AMQP                             |
| ------------ | :-------------------------------------: | :----------------------------------------------------------: |
| 定义         |                Java API                 |                             协议                             |
| 跨语言       |                   否                    |                              是                              |
| 跨平台       |                   否                    |                              是                              |
| 支持消息类型 | 提供两种消息模型：①Peer-2-Peer;②Pub/sub | 提供了五种消息模型：①direct exchange；②fanout exchange；③topic change；④headers exchange；⑤system exchange。本质来讲，后四种和 JMS 的 pub/sub 模型没有太大差别，仅是在路由机制上做了更详细的划分； |
| 支持消息类型 |            支持多种消息类型             |                       byte[]（二进制）                       |

