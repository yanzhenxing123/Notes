# sredash-api 中间表

## PaaS

### 流通话表

基础字段

- **sessionid**  // session, 用户每次进入一次频道都是不同的session

- **channelId** // 频道Id 

- channelName // 频道对外显示名

- merchantId     // 机构ID

- merchantName // 机构显示名

- **uid**                      // 用户UID

- **refUid** 对端uid   

- appId                 // 应用ID

- os                       // 系统

- Platform            // 平台

- role                    // 角色

- client       

- clientVer

- Apppack

- appVer

- sdkVer

- deviceId

- geo

- Duration float  //通话时长 ， 用户对对端用户通话时长



衍生字段

- joinChannelElapsed // 加入频道耗时    **joinChannelElapsed: elapsed**
- joinChannelResult 加入频道是否成功  **joinChannelResult： result**
- joinChannelfailedReason 加入频道失败原因  **joinChannelResult： reason**
- receivingStreamMessageElapsed 接收流消息耗时
- connectStreamServiceElapsed 连接流服务器耗时
- pullStreasmElapsed 拉流耗时  **mediadownlinkrate: len(range['vedio']) * step**
- FirstVideoFrame  第一视频帧耗时   **firstVideoFrame：elapsed**
- FIrstAudioFrame  第一音频帧耗时   **firstAudioFrame： elapsed**
- videoPullStreamDuration 视频流拉流时长
- audioPullStreamDuration 音频流拉流时长
- videoFrozenDuration 视频卡顿时长(卡顿大于600ms)
- 视频卡顿次数
- audioFrozenDuration 音频卡顿时长 (卡顿大于200ms)
- 音频卡顿次数
- classIFrozen bool 一类卡顿(卡顿时长大于5s)
- 一类卡顿时长
- 一类卡顿次数
- classIIFrozen bool 二类卡顿(存在30s超过三次600ms卡顿) 
- 二类卡顿时长
- 二类卡顿次数
- 音视频不同步次数
- RTT平均值
- RTT最大值
- RTT中位数
- 95thRTT
- 99thRTT
- 丢包率平均值
- 丢包率最大值
- 丢包率中位数
- 95th丢包率
- 99th丢包率





## mongo查询

+ 有卡顿的

  ```sql
  db.paas_user_stream.find({"audioFrozenDuration": {"$exists":true} }).pretty().count()
  db.paas_user_stream.find({"frozenDuration": {"$exists":true} }).pretty().count()
  ```

  

+ 

+ db.paas_user_stream.find({"audioFrozenDuration": {"$exists":true} }).pretty().count()




## 部署

cd /usr/local/k8s/config



mongo： [172.20.2.44:27017](http://172.20.2.44:27017)	

kubectl apply -f data-intermediate-table.yaml 



kubectl exec -it data-intermediate-table-596c7f57f8-8hqxb /bash/sh -n report

```
registry.cn-beijing.aliyuncs.com/duobeiyun/dby-datacenter-statics
```











