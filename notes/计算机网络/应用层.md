# 应用层

## DNS

### dns服务器

+ 根dns服务器
+ 顶级域(dns)服务器
+ 权威dns服务器: 拥有该域名的IP地址
+ 递归dns（本地dns服务器）

### 查询的过程

+ 递归查询：请求主机向本地DNS服务器查询
+ 迭代查询：本地DNS服务器向根域名服务器等dns服务器查询

理论上讲，任何dns查询既可以是迭代的也可以是递归的，而实际情况为：从主机到本地dns服务器为递归的，其余查询都是迭代的。

![](http://help-docs-aliyun.aliyuncs.com/assets/pic/60303/intl_zh/1507536306873/website%20access.png)



## HTTP

### 特点

+ 无状态

+ 默认使用持续连接，可以配置成非持续连接

  + 非持续连接
    + 传输文件所消耗的时间：两个RTT (三次握手RTT和http请求/响应RTT)+ 文件传输的时间
    + 每一个请求对象都要经历以上的过程，如果有10个静态文件，那么就要有20个RTT
  + 持续连接
    + 解决上面RTT过多的问题
    + 如果一个TCP太长时间未使用，那么HTTP就关闭这个连接

+ http报文格式

  ![image-20211010192925142](https://i.loli.net/2021/10/10/uw9f57d8ezkvBoK.png)

![image-20211010193518454](https://i.loli.net/2021/10/10/FOdq2eWouyARmIl.png)

## SMTP

+ 使用TCP可靠数据传输服务。
+ SMTP一般不使用中间邮件服务器

+ 用户代理和邮件服务器之间发送邮件使用SMTP，读取邮件使用IMAP或POP3
+ 邮件服务器（smtp server）之间传输使用的协议为smtp

![smtp](https://pic2.zhimg.com/50/v2-f8d4f0ef57e34d043923c85fc7767a54_720w.jpg?source=1940ef5c)

用户代理<------->邮件服务器<-------------------------------->邮件服务器<------->用户代理

邮件服务器发送时作为client，接收时作为server。

### 与http进行对比

+ smtp是一个**推协议**，http则是一个**拉协议**
+ smtp要求每个报文（包括它们的体）都使用7比特ASCII码格式，http数据不受这些限制
+ 如何处理一个既有文本又有图片的文档
  + http将每个对象都封装到它自己的http响应报文中
  + smtp则把所有的报文对象放在一个报文中

### POP3

三个阶段

+ 特许（认证阶段）
+ 事务处理
+ 更新

允许电子邮件客户端下载服务器上的邮件，但是在客户端的操作（如移动邮件、标记已读等），不会反馈到服务器上，比如通过客户端收取了邮箱中的3封邮件并移动到其他文件夹，邮箱服务器上的这些邮件是没有同时被移动的 。

### IMAP

+ 比pop3协议更加复杂
+ IMAP支持在文件在服务器上移动到另一个文件夹中
+ 与smtp服务器进行双向通信

提供webmail 与电子邮件客户端之间的双向通信，客户端的操作都会反馈到服务器上，对邮件进行的操作，服务器上的邮件也会做相应的动作

![](http://nos.netease.com/help/588fcc36fc540643d84c80addabb00ec.jpg)

## P2P文件分发

当新用户向服务器请求某个文件的下载时，若此时存在其他用户正在进行同一文件的下载行为，则服务器会分配一定用户分配自身的上载功能来帮助新用户更快的获取文件。

### BitTorrent

正在下载文件的用户称为洪流，每一个用户都分配一个追踪器，当一个新用户将要下载时，追踪器会给该用户分配一定数量的其他洪流用户，并让这些洪流用户与新用户建立连接，然后洪流用户把已经下载的部分放到一张表中，新用户根据自己没有下载的进行反馈给洪流用户，收到反馈的洪流用户会提供自身一部分上载功能将新用户所需要的文件块上载给新用户，文件块大小一般为256KB。



## CDN 内容分发网络

尽可能避开互联网上有可能影响数据传输速度和稳定性的瓶颈和环节，使内容传输的更快、更稳定。通过在网络各处放置节点服务器所构成的在现有的互联网基础之上的一层智能虚拟网络，CDN系统能够实时地根据网络流量和各节点的连接、负载状况以及到用户的距离和响应时间等综合信息将用户的请求重新导向离用户最近的服务节点上。



